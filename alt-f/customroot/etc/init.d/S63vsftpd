#! /bin/sh

DESC="vsftpd"
NAME=vsftpd

CONF=/etc/vsftpd.conf

. $(dirname $0)/common

sinit() {
	if test -f $CONF; then
		. $CONF
		if test -n "$secure_chroot_dir" -a ! -d "$secure_chroot_dir"; then
			mkdir -p "$secure_chroot_dir"
		fi
 		if test "$ssl_enable" = "yes" -a -n "$rsa_cert_file" -a ! -f  "$rsa_cert_file"; then
			tf=$(mktemp -t)
			echo -e ".\n.\n.\n.\n.\n$(hostname)\n.\n" > $tf
			openssl req -x509 -nodes -days 3650 -newkey rsa:1024 -keyout  "$rsa_cert_file" -out "$rsa_cert_file" < $tf  2> /dev/null
			rm -f $tf
			chmod og-r $rsa_cert_file
		fi
	fi
}

case "$1" in
	start)
		sinit
		start $NAME
		;;
	stop) stop $NAME ;;
	status) status $NAME ;;
	init) sinit ;;
	restart) restart $NAME ;;
	*) usage $0 "start|stop|status|restart|init" ;;
esac
