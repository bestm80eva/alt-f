<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>ALT-F Help Page</title>
</head><body>

<center><h2>Backups Setup Help</h2></center>

This service makes unattended backups of various kinds, all following the same pattern.

<p><strong>Directory</strong> is the directory from where to make the backup.

<p>E.g., if <strong>Directory</strong> is <code>/mnt/sda3/Music</code>, the backup will reside in directory <code>/Backup/sda3_Music</code> with several sub-directories named after the backup date and time, and a special file named "current" that refers to the last backup done:

<pre>
	2011-10-03_17-56-02
	2011-10-03_17-56-45
	2011-10-03_18-08-28
	current -> 2011-10-03_18-08-28
</pre>

<p>The first time a backup is done a full copy of the source directory is made, and on
subsequent backups only new, deleted or modified files are updated.<br>
Unaltered files are kept as references to the files last version, not occupying extra space.

<p><strong>When</strong> specifies the week day to perform a backup, with 0 meaning Sunday, 1-Monday, 2-Tue... and 0,2,4 meaning every Sun, Tue and Thu, and 0-2 meaning every Sun, Mon and Tue; * means everyday.

<p><strong>At</strong> specifies the hour when the backup is to be made, following the same pattern as above. Hour uses a 24 hour format.

<p><strong>Rotate</strong> is the number of backups kept, with the oldest being deleted after
a new one is made; in the above example, if Rotate is 3, after a new backup finishes the 
2011-10-03_17-56-02 backup will be deleted.<br>

If Rotate is 0, a new directory will be created everytime the backup time arrives,
until disk space exhausts.

<p><strong>Log</strong> creates a log file with new, deleted or changed files in every backup, but doing it is a <strong>very, very</strong> slow process, so avoid using it except on small directories. If there are no changes, this useless backup will be deleted.

<p><strong>Backup types:</strong>

<ul>
<p><li><strong>Dir</strong> this mode of operation only backups local directories. You can use it to backup directories from one disk to the other, e.g.<br>
The <strong>Run As</strong> entry should be user "root", so the backup files original date, permissions and owners are preserved.

<p><li><strong>NFS</strong> this mode of operation mounts a directory from the remote <strong>Host</strong> using NFS, then continue as in the <strong>Dir</strong> mode. It's purpose is mainly to create backups from UNIX/Linux machines.<br>
For this mode of operation to work, there must exist user equivalence between the user on the remote machine and an user on the box; user equivalence means that the user and group ID should be the same on both machines, and it is setup when the user is created.<br>
Most of the time the user "root" is not allowed to be also "root" on remote machines, so the <strong>Run As</strong> entry has to be set to the user who owns the files on the remote machine, in order for the remote directory to be browseable and backup files keeps its original date, permissions and owners.<br>
If <strong>Host</strong> is named <em>silver</em> and <strong>Run As</strong> is <em>Joao Cardoso</em>, which has <em>jcard</em> as its nick name, and <strong>Directory</strong> is <em>/home/jcard/src</em> then the backup will be located in <code>/Backup/silver_home_jcard_src/</code><br>
If at the time you setup an entry of this type the remote host is powered on, its MAC will be retrieved and stored; at backup time, if the remote host is not answering, it will be sent a magic packet (WOL) trying to awake it up; setting the remote host to be powered-up in this way is out of scope.

<p><li><strong>CIFS</strong> this mode of operation is similar to the NFS mode, but mounts a directory from the remote <strong>Host</strong> using CIFS/SMB (samba). It's purpose is mainly to create backups from MS_Windows machines.<br>
For this mode of operation to work, there must exist an user with the same name and password on both machines, and the <strong>Run As</strong> entry should be the user who owns the files to backup on the remote machine.<br>
Notice that the user name is the full user name, such as <em>Joao Cardoso</em>, not the user nick name, <em>jcard</em>.<br>

If <strong>Host</strong> is named <em>MONO</em> and <strong>Run As</strong> is <em>Joao Cardoso</em>, and <strong>Directory</strong> is <em>Users/Joao Cardoso/Music</em> then the backup will be located in <code>/Backup/MONO_Users_Joao_Cardoso_Music/</code><br>

As in the NFS mode of operation the remote host is sent a WOL packet if necessary.

<p><li><strong>HTTP</strong> this mode of operation keeps a local mirror of the remote host directory, using the <em>wget</em> program, than proceeds as in the DIR mode. The mirror is kept between backups and is updated before the backup is done, so only new/deleted/changed files are downloaded.<br>

If <strong>Host</strong> is named <em>silver</em> and <strong>Directory</strong> is <em>~jcard/ensino/LabC</em> then the backup will be located in <code>
/Backup/silver_~jcard_ensino_LabC</code>, and the content of the backup directory will be
<pre>
	2011-10-03_21-38-41
	21:37 2011-10-03_21-40-21
	current -> 2011-10-03_21-40-21
	mirror
</pre>

where <code>mirror</code> is the mirror of the remote location.<br>
The only effect of <strong>Run As</strong> is that the backup belongs to the given user.<br>

This backup scheme keeps two copies of the same file, one in the mirror directory and other in the backup directories, so it will need twice the disk space needed by the other backup schemes.<br>

Please note also that doing the backup does not means that all files present in the remote host will be available; only the files that you can see or download following the site pages will be downloaded.<br>

<p><li><strong>FTP</strong> this mode of operation is similar to the HTTP one, except that authentication might be used if a <code>.netrc</code> file is found in the home directory of the <strong>Run As</strong> user.<br>
The file <code>.netrc</code> format specifies in each line a username and a password to be used  in a given host:<br>
<code>&nbsp;&nbsp;&nbsp;machine &lt;host-name&gt; login &lt;user-name&gt; password &lt;password&gt;</code><br>
e.g., <code>machine silver login jcard password mypasswordonsilver</code><br>
The file should have permissions so that nobody else can read it, use the command<br>
<code>&nbsp;&nbsp;&nbsp;chmod og-rwx .netrc</code><br>
If <strong>Host</strong> is named <em>silver</em> and <strong>Directory</strong> is <em>win</em>, and <strong>Run As</strong> is <em>Joao Cardoso</em>, which has <em>jcard</em> as its nick name, then the backup will be located in <code>/Backup/silver_jcard_win</code><br>

<p><li><strong>rsync</strong> this mode of operation uses the <em>rsync</em> program to make the backup. It can work in two modes: using rsync/ssh or a rsync daemon on the remote host.<br>
The backup script first tries to use the daemon mode, and if unsuccessful tries the rsync/ssh mode.<br>
<ul>
<li>For the daemon mode, there must exist a rsync user with the same nick name and password in both computers, and a remote rsync daemon must be setup first. In the remote host a file <em>/etc/rsyncd.secrets</em> must exist with lines of the form <em>user:password</em> and the file <em>/etc/rsyncd.conf</em> must contain the definition of the module to backup.<br>

The <strong>Directory</strong> entry must start with the daemon <em>module</em> name to backup.<br>
If <strong>Directory</strong> is <em>vuze/plugins</em> and a rsync module named <em>vuze</em> exists in <strong>host</strong> <em>silver</em>, where user <strong>Run As</strong> has permissions to use the module and its <em>nick:password</em> is in the <em>/etc/rsyncd.secrets</em> file, then the backup will be located in <code>/Backup/silver_vuze_plugins</code>.<br>


<li>In the rsync/ssh mode, password-less login using ssh cryptographic keys has to be manually setup.<br>
If a <code>.ssh/identity</code> file is not found in the <strong>Run As</strong> home directory, <em>ssh</em> keys will be created for him and a file with instructions left in his home directory. After following the instructions the backup should proceed normally.<br>

If <strong>host</strong> is <em>silver</em>, <strong>Directory</strong> is <em>workspace</em> and <strong>Run As</strong> is jcard, then the backup will be located in <code>/Backup/silver_jcard_workspace/</code>.<br>

</ul


</ul>

<br><button type=button onclick="history.back()">Back</button></body>
