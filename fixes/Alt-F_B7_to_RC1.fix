#!/bin/sh

# fix smb.conf:

if ! grep -q '\(^passdb backend\|^use client driver\)' /etc/samba/smb.conf; then
	sed -i -e 's/encrypt passwords = yes/encrypt passwords = yes\npassdb backend = smbpasswd/' \
		-e 's/\[Printers\]/\[Printers\]\nuse client driver = yes/' /etc/samba/smb.conf
fi

# reinstall packages keeping configuration files

if test -f /usr/bin/ipkg-cl; then
	ipkg update
	ipkg -force-defaults upgrade
fi
